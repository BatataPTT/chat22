<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="stylesheet" href="chat.css">
    <script type="module">
        // Importando Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCzI_nGXv0Oj0MzMNxthS5m42yFx070o-A",
            authDomain: "chat-4272f.firebaseapp.com",
            databaseURL: "https://chat-4272f-default-rtdb.firebaseio.com",
            projectId: "chat-4272f",
            storageBucket: "chat-4272f.appspot.com",
            messagingSenderId: "187202754618",
            appId: "1:187202754618:web:0a12d69d6e6193df2f7d03",
            measurementId: "G-8TKSLG7M9L"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Função para adicionar mensagens ao chat
        function addMessageToChat(message, user) {
            const chatList = document.querySelector('.text');
            const listItem = document.createElement('li');
            listItem.textContent = `${user}: ${message}`;
            chatList.appendChild(listItem);
        }

        // Ouvir as mensagens do banco de dados
        const messageRef = ref(database, 'chat');
        onValue(messageRef, (snapshot) => {
            const messages = snapshot.val();
            document.querySelector('.text').innerHTML = ''; // Limpa a lista antes de adicionar as mensagens
            for (let id in messages) {
                addMessageToChat(messages[id].texto, messages[id].user);
            }
        });

        document.getElementById('btn').addEventListener('click', function() {
            const message = document.getElementById('msg').value;
            const user = localStorage.getItem("Nome") || 'Anônimo'; // Nome do usuário
            const newMessageRef = push(messageRef);
            set(newMessageRef, { texto: message, user: user });
            document.getElementById('msg').value = ''; // Limpar o campo
        });
    </script>
</head>
<body>
    <div class="chatbox">
        <input type="text" id="msg" placeholder="Digite sua mensagem...">
        <button id="btn">Enviar</button>
    </div>

    <div class="chat">
        <ul class="text">
            <!-- As mensagens aparecerão aqui -->
        </ul>
    </div>
</body>
</html>
